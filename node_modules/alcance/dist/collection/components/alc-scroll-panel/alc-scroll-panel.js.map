{"version":3,"file":"alc-scroll-panel.js","sourceRoot":"","sources":["../../../../src/components/alc-scroll-panel/alc-scroll-panel.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, Listen, State, Element, forceUpdate, Prop, Watch } from '@stencil/core';\nimport logger from '../utils/logger';\nimport { throttle } from '../utils/throttle';\n\nconst SCROLL_STEP = 20;\n\n@Component({\n  tag: 'alc-scroll-panel',\n  styleUrls: {\n    base: 'alc-scroll-panel-base.css',\n    theme: 'alc-scroll-panel.css'\n  },\n  scoped: false,\n})\nexport class AlcScrollPanel {\n\n  @Element() el: HTMLAlcScrollPanelElement;\n\n  @State() hasScroll: boolean = false;\n  @State() canScrollRight: boolean = false;\n  @State() canScrollLeft: boolean = false;\n  /**\n  * Define se há foco.\n  */\n  @Prop({ reflect: true }) hasFocus: boolean = true;\n  /**\n  * Define para qual elemento o scroll vai.\n  */\n  @Prop({ reflect: true }) scrollToElement: HTMLElement;\n\n  private content: HTMLDivElement;\n  private scrollWidth: number = 0;\n  private scrolling: number = 0;\n  private mo: MutationObserver;\n  private resizeThrottle = throttle(this.resize, 200);\n  private scrollThrottle = throttle(this.handleScroll, 300);\n\n  @Listen('themeLoaded', {\n    target: 'window'\n  })\n  themeLoadedHandler() {\n    this.handleScroll();\n  }\n\n  @Listen('resize', { target: 'window' })\n  handleResize() {\n    this.resizeThrottle();\n  }\n\n  @Watch('scrollToElement')\n  handleScrollToElement(element: HTMLElement) {\n    if(!!element){\n      element.scrollIntoView({ inline: \"center\", block: 'nearest' });\n    }\n  }\n\n  private resize() {\n    this.handleScroll();\n    this.handleScrollToElement(this.scrollToElement);\n  }\n\n  private handleScroll() {\n    this.scrollWidth = this.content.scrollWidth;\n    this.hasScroll = this.scrollWidth > this.content.offsetWidth;\n    this.setCanScroll();\n  }\n\n  private scrollRight() { // Pra frente >>>\n    this.content.scrollLeft += SCROLL_STEP;\n    this.setCanScroll();\n  }\n\n  private scrollLeft() { // Pra trás <<<\n    this.content.scrollLeft = this.content.scrollLeft - SCROLL_STEP;\n    this.setCanScroll();\n  }\n\n  private startScrolling(button: HTMLButtonElement, scroll: Function) {\n    if (this.scrolling) return;\n\n    this.scrolling = window.setInterval(() => {\n      if (button.disabled) {\n        this.stopScrolling();\n        return;\n      }\n\n      scroll.apply(this);\n    }, 200);\n  }\n\n  private startScrollingRight(e: MouseEvent) {\n    const button = e.currentTarget;\n\n    if(button instanceof HTMLButtonElement) {\n      this.startScrolling(button, this.scrollRight);\n    }\n  }\n\n  private startScrollingLeft(e: MouseEvent) {\n    const button = e.currentTarget;\n\n    if(button instanceof HTMLButtonElement) {\n      this.startScrolling(button, this.scrollLeft);\n    }\n  }\n\n  private stopScrolling() {\n    window.clearInterval(this.scrolling);\n    this.scrolling = 0;\n  }\n\n  private setCanScroll() {\n    // Math.ceil foi necessário ao verificar funcionamento em um dispositivo móvel real,\n    // onde scrollLeft apresenta números fracionários.\n    this.canScrollRight = Math.ceil(this.content.offsetWidth + this.content.scrollLeft) < this.scrollWidth;\n    this.canScrollLeft = this.content.scrollLeft > 0;\n  }\n\n  componentDidRender() {\n    /*\n     O trecho abaixo permite que o componente seja atualizado\n     sempre que houver mudanças no conteúdo (como a inclusão de \"fihos\").\n     Isso foi feito para permitir, por exemplo, que o conteúdo do panel\n     seja atualizado dinamicamente com a manipulação do DOM.\n     */\n    this.mo?.disconnect();\n    this.mo = new MutationObserver(() => {\n      logger.debug('forceUpdate scroll-panel');\n      forceUpdate(this.el);\n    });\n    this.mo.observe(this.el, {\n      childList: true,\n      subtree: true\n    });\n\n    this.handleScroll();\n  }\n\n  disconnectedCallback() {\n    this.mo?.disconnect();\n    this.resizeThrottle.cancel();\n    this.scrollThrottle.cancel();\n  }\n\n  render() {\n    return (\n      <Host>\n        <div class=\"alc-scroll-panel\">\n          {\n            this.hasScroll\n            ? <div\n                key=\"left-button\"\n              >\n                <button\n                  onClick={this.scrollLeft.bind(this)}\n                  onMouseDown={this.startScrollingLeft.bind(this)}\n                  onMouseUp={this.stopScrolling.bind(this)}\n                  onTouchStart={this.startScrollingLeft.bind(this)}\n                  onTouchEnd={this.stopScrolling.bind(this)}\n                  onTouchCancel={this.stopScrolling.bind(this)}\n                  class=\"alc-scroll-panel__button\"\n                  disabled={!this.canScrollLeft}\n                  aria-label=\"Ir para esquerda\"\n                  tabindex={this.hasFocus ? '0' : '-1'}\n                >\n                  <alc-icon name=\"chevron-left\" label=''></alc-icon>\n                </button>\n              </div>\n            : null\n          }\n          <div\n            class={{\n              \"alc-scroll-panel__wrapper-content\": true,\n              \"alc-scroll-panel__has-scroll-left\": this.canScrollLeft,\n              \"alc-scroll-panel__has-scroll-right\": this.canScrollRight\n            }}\n            key=\"content\"\n          >\n            <div\n              class=\"alc-scroll-panel__content\"\n              ref={el => this.content = el}\n              onScroll={() => this.scrollThrottle()}\n            >\n              <slot />\n            </div>\n          </div>\n          {\n            this.hasScroll\n            ? <div\n                key=\"right-button\"\n              >\n                <button\n                  onClick={this.scrollRight.bind(this)}\n                  onMouseDown={this.startScrollingRight.bind(this)}\n                  onMouseUp={this.stopScrolling.bind(this)}\n                  onTouchStart={this.startScrollingRight.bind(this)}\n                  onTouchEnd={this.stopScrolling.bind(this)}\n                  onTouchCancel={this.stopScrolling.bind(this)}\n                  class=\"alc-scroll-panel__button\"\n                  disabled={!this.canScrollRight}\n                  aria-label=\"Ir para direita\"\n                  tabindex={this.hasFocus ? '0' : '-1'}\n                >\n                  <alc-icon name=\"chevron-right\" label=''></alc-icon>\n                </button>\n              </div>\n            : null\n          }\n        </div>\n      </Host>\n    );\n  }\n}"]}