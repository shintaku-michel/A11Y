{"version":3,"file":"alc-field-checker.entry.js","sources":["src/components/alc-field-checker/alc-field-checker.css?tag=alc-field-checker","src/components/alc-field-checker/alc-field-checker.tsx"],"sourcesContent":["\n.alc-field-checker {\n  @apply block;\n}\n","import { Component, h, State, Element, Prop } from '@stencil/core';\nimport { getUniqueId } from '../utils/getUniqueId'\n@Component({\n  tag: 'alc-field-checker',\n  styleUrl: 'alc-field-checker.css',\n  shadow: false,\n})\nexport class AlcFieldChecker {\n  private idAlert = null;\n  @Element() hostElement: HTMLElement;\n  @State() errorFields: { id: string; label: string; errorMsg: string }[] = [];\n   /**\n   * Verifica o formulário quando houver submissão.\n  */\n  @Prop({ reflect: true }) checkOnSubmit = false;\n  observer: MutationObserver;\n\n  componentWillLoad() {\n    this.idAlert = getUniqueId();\n  }\n  componentDidLoad() {\n    // Se true, o componente só irá verificar os campos caso haja uma submissão de formulário\n    if (!this.checkOnSubmit) {\n      this.checkAlcFields();\n      this.observer = new MutationObserver(() => this.checkAlcFields());\n      const alcFields = this.hostElement.querySelectorAll('alc-field, alc-fieldset, alc-checkbox, alc-radio');\n      // Observa apenas os componentes alc-field que estão dentro do alc-field-checker, permitindo o uso de mais de um formulário por página\n      alcFields.forEach((field) => this.observer.observe(field, { attributes: true, childList: true, subtree: true }));\n    } else {\n      const formElement = this.hostElement.querySelector('form');\n      if (formElement) {\n        formElement.addEventListener('submit', this.handleFormSubmit);\n      }\n    }\n  }\n\n  disconnectedCallback() {\n    this.observer?.disconnect();\n  }\n\n  getFieldId(field: Element): string {\n    // Obtém o ID do element filho (input, select e etc que estão dentro do alc-field) para criar a âncora quando houver erro\n    const inputElement = field.querySelector('input, textarea, select');\n    return inputElement ? inputElement.getAttribute('id') : '';\n  }\n\n  isChildOfFieldset(element: Element): boolean {\n    // Verifica se o alc-checkbox e alc-radio são filhos de um alc-fieldset\n    return element.closest('alc-fieldset') !== null;\n  }\n\n  getLabelText(field: Element): string {\n    // Obtém o texto dos componentes alc-checkbox e alc-radio, já que não possuem a propriedade label\n    const labelElement = field.querySelector('label');\n    return labelElement ? labelElement.textContent.trim() : '';\n  }\n\n  checkAlcFields() {\n    const alcFields = Array.from(this.hostElement.querySelectorAll('alc-field, alc-fieldset, alc-checkbox, alc-radio'))\n    .filter((field) => {\n      // Se os componentes alc-checkbox e alc-radio forem filhos de um alc-fieldset, o atributo error-msg deles serão ignorados\n      if (field.tagName.toLowerCase() === 'alc-checkbox' || field.tagName.toLowerCase() === 'alc-radio') {\n        return !this.isChildOfFieldset(field);\n      }\n      return true;\n    });\n    this.errorFields = alcFields\n      // Apenas os alc-field que possuem a propriedade erro-msg com alguma mensagem, são enviados para o mapa de erros\n      .filter((field) => field.hasAttribute('error-msg') && field.getAttribute('error-msg') !== '')\n      .map((field) => {\n        const isCheckboxOrRadioButton = field.tagName.toLowerCase() === 'alc-checkbox' || field.tagName.toLowerCase() === 'alc-radio';\n        const isFieldset = field.tagName.toLowerCase() === 'alc-fieldset';\n        return {\n          id: this.getFieldId(field),\n          label: isCheckboxOrRadioButton ? this.getLabelText(field) : isFieldset ? field.getAttribute('legend') : field.getAttribute('label'),\n          errorMsg: field.getAttribute('error-msg'),\n        };\n      });\n  }\n\n  handleFormSubmit = (e: Event) => {\n    this.checkAlcFields();\n    if (this.errorFields.length > 0) {\n      e.preventDefault();\n    }\n  };\n\n  render() {\n    return (\n      <div class=\"alc-field-checker\">\n        {this.errorFields.length > 0 && (\n          <alc-alert id={this.idAlert} type=\"warning\" dismissible={false}>\n            <span class='alc-alert__summary'>Atenção: Seu formulário contém {this.errorFields.length} {this.errorFields.length > 1 ? \"erros\" : \"erro\"}</span>\n            <ul>\n              {this.errorFields.map((field) => (\n                <li>\n                  <a href={`#${field.id}`} class=\"alc-link alc-link--color-text\">\n                    <strong>{field.label}:</strong> {field.errorMsg}\n                  </a>\n                </li>\n              ))}\n            </ul>\n          </alc-alert>\n        )}\n        <slot></slot>\n      </div>\n    );\n  }\n}\n"],"names":[],"mappings":"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"}